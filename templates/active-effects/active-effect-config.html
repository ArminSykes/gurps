<form autocomplete='off' class='active-effect-config'>
  <!-- Effect Header -->
  <header class='sheet-header'>
    <img class='effect-icon' src='{{data.icon}}' data-edit='icon' />
    <h1 class='effect-title'>{{ data.label }}</h1>
  </header>

  <!-- Effect Configuration Tabs -->
  <nav class='sheet-tabs tabs'>
    <a class='item' data-tab='details'><i class='fas fa-book'></i> {{i18n 'EFFECT.TabDetails'}}</a>
    <a class='item' data-tab='duration'><i class='fas fa-clock'></i> {{i18n 'EFFECT.TabDuration'}}</a>
    <a class='item' data-tab='effects'><i class='fas fa-cogs'></i> {{i18n 'EFFECT.TabEffects'}}</a>
  </nav>

  <!-- Details Tab -->
  <section class='tab' data-tab='details'>
    <div class='form-group'>
      <label>{{ localize 'EFFECT.Label' }}</label>
      <div class='form-fields'>
        <input type='text' name='label' value='{{ data.label }}' />
      </div>
    </div>

    <div class='form-group'>
      <label>{{ localize 'EFFECT.Icon' }}</label>
      <div class='form-fields'>
        {{filePicker target='icon' type='image'}}
        <input class='image' type='text' name='icon' placeholder='path/image.png' value='{{data.icon}}' />
      </div>
    </div>

    <div class='form-group'>
      <label>{{ localize 'EFFECT.IconTint' }}</label>
      <div class='form-fields'>
        <input class='color' type='text' name='tint' value='{{data.tint}}' />
        <input type='color' value='{{data.tint}}' data-edit='tint' />
      </div>
    </div>

    <div class='form-group'>
      <label>{{ localize 'EFFECT.Disabled' }}</label>
      <input type='checkbox' name='disabled' {{ checked data.disabled }} />
    </div>

    {{#if isActorEffect}}
      <div class='form-group'>
        <label>{{ localize 'EFFECT.Origin' }}</label>
        <div class='form-fields'>
          <input type='text' name='origin' value='{{ data.origin }}' disabled />
        </div>
      </div>
    {{/if}} {{#if isItemEffect}}
      <div class='form-group'>
        <label>{{ localize 'EFFECT.Transfer' }}</label>
        <div class='form-fields'>
          <input type='checkbox' name='transfer' {{checked data.transfer}} />
        </div>
      </div>
    {{/if}}
  </section>

  <!-- Duration Tab -->
  <section class='tab' data-tab='duration'>
    <div class='form-group'>
      <label>{{ localize 'EFFECT.DurationSecs' }}</label>
      <div class='form-fields'>
        <input type='number' name='duration.seconds' value='{{ data.duration.seconds }}' />
      </div>
    </div>
    <div class='form-group'>
      <label>{{ localize 'EFFECT.StartTime' }}</label>
      <div class='form-fields'>
        <input type='number' name='duration.startTime' value='{{ data.duration.startTime }}' />
      </div>
    </div>
    <hr />
    <div class='form-group'>
      <label>{{i18n 'GURPS.effectsTermination'}}</label>
      <div class='form-fields'>
        <input type='text' name='flags.gurps.effect.endCondition' value='{{ data.flags.gurps.effect.endCondition }}' />
      </div>
    </div>
    <hr />
    <div class='form-group'>
      <label>{{ localize 'EFFECT.DurationTurns' }}</label>
      <div class='form-fields'>
        <label>{{ localize 'COMBAT.Turns' }}</label>
        <input type='number' name='duration.rounds' value='{{ data.duration.rounds }}' />
        <!-- <label>{{ localize 'COMBAT.Turns' }}</label>
        <input type='number' name='duration.turns' value='{{ data.duration.turns }}' /> -->
        <label style='flex: 1; text-align: right;'>{{i18n 'gurps.effects.endofturn' 'End of Turn'}}</label>
        <input type='checkbox' id='end-of-turn' name='flags.gurps.effect.endOfTurn'
          {{checked data.flags.gurps.effect.endOfTurn}} />
      </div>
    </div>
    <div class='form-group'>
      <label>{{ localize 'EFFECT.Combat' }}</label>
      <div class='form-fields'>
        <input type='text' name='duration.combat' value='{{ data.duration.combat }}' disabled />
      </div>
    </div>

    <div class='form-group'>
      <label>{{ localize 'EFFECT.StartTurns' }}</label>
      <div class='form-fields'>
        <label>{{ localize 'COMBAT.Turn' }}</label>
        <input type='number' name='duration.startRound' value='{{ data.duration.startRound }}' />
        <!-- <label>{{ localize 'COMBAT.Turn' }}</label>
        <input type='number' name='duration.startTurn' value='{{ data.duration.startTurn }}' /> -->
      </div>
    </div>
  </section>

  <!-- Effects Tab -->
  <section class='tab' data-tab='effects'>
    <header class='effect-change effects-header flexrow'>
      <div class='key'>{{ localize 'EFFECT.ChangeKey' }}</div>
      <div class='mode'>{{ localize 'EFFECT.ChangeMode' }}</div>
      <div class='value'>{{ localize 'EFFECT.ChangeValue' }}</div>
      <div class='effect-controls'>
        <a class='effect-control' data-action='add'><i class='far fa-plus-square'></i></a>
      </div>
    </header>
    <ol class='changes-list'>
      {{#each data.changes as |change i|}}
        <li class='effect-change flexrow' data-index='{{i}}'>
          <div class='key gurps-effect-controls'>
            <select name='changes.{{i}}.key' class='gurps-effect-control' data-action='select-key' data-index='{{i}}'>
              {{selectOptions ../changes selected=change.key localize=true}}
              <!-- <option value='other'>&lt;{{i18n 'GURPS.moveModeOther'}}&gt;</option> -->
            </select>
            <div class='expand-container gurps-effect-controls' style='overflow: hidden; line-height: 0'>
              <input id='expand-contract-{{key}}'
                class='expand-contract splitdr-control contracted gurps-effect-control' data-action='edit-key'
                type='text' value='{{i18n type type}}' />
            </div>
          </div>
          <div class='mode' class='gurps-effect-controls'>
            <select name='changes.{{i}}.mode' data-dtype='Number' class='gurps-effect-control'
              data-action='select-mode'>
              {{selectOptions ../modes selected=change.mode}}
            </select>
          </div>
          <div class='value' class='gurps-effect-controls'>
            <select name='changes.{{i}}.value' class='gurps-effect-control' data-index='{{i}}' data-dtype='text'
              data-action='select-boolean'>
              <option value='true' {{select-if change.value 'true'}}>{{i18n 'gurps.general.true' 'True'}}</option>
              <option value='false' {{select-if (ne change.value 'true') true}}>{{i18n 'gurps.general.false' 'False'}}
              </option>
            </select>
            <select name='changes.{{i}}.value' class='gurps-effect-control' data-index='{{i}}' data-dtype='text'
              data-action='select-posture'>
              <option value='standing' {{select-if change.value 'standing'}}>{{i18n 'GURPS.STATUSStanding'}}</option>
              {{#each (listAllPostures) as |this key|}}
                <option value='{{key}}' {{select-if change.value key}}>{{i18n this.label}}</option>
              {{/each}}
            </select>
            <select name='changes.{{i}}.value' class='gurps-effect-control' data-index='{{i}}' data-dtype='text'
              data-action='select-maneuver'>
              {{#each (listAllManeuvers) as |this key|}}
                <option value='{{key}}' {{select-if change.value key}}>{{i18n this.label}}</option>
              {{/each}}
            </select>
            <input name='changes.{{i}}.value' class='gurps-effect-control' data-index='{{i}}' type='text'
              data-action='edit' data-value='{{change.value}}' value='{{localize change.value}}' />
          </div>
          <div class='effect-controls'>
            <a class='effect-control' data-action='delete'><i class='fas fa-trash'></i></a>
          </div>
        </li>
      {{/each}}
    </ol>
  </section>

  <footer class='sheet-footer'>
    <button type='submit'><i class='fas fa-save'></i> {{i18n submitText}}</button>
  </footer>
</form>